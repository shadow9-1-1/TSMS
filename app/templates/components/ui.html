{#
    Reusable UI Components for Flask Jinja Templates
    
    Modern SaaS-style components using TailwindCSS.
    
    Usage:
        {% from "components/ui.html" import card, button, input_field, alert, modal, table %}
        
        {{ card(title="Dashboard", subtitle="Overview") }}
        {{ button("Save", variant="primary") }}
        {{ input_field(form.email, label="Email Address") }}
        {{ alert("Success!", type="success") }}
#}


{# ============================================
   BUTTON COMPONENT
   ============================================ #}
{% macro button(
    text,
    variant="primary",
    size="md",
    type="button",
    href=none,
    icon=none,
    icon_position="left",
    disabled=false,
    full_width=false,
    class=""
) %}
    {# Variant styles #}
    {% set variants = {
        'primary': 'bg-gradient-to-r from-primary-600 to-primary-500 text-white shadow-lg shadow-primary-500/25 hover:shadow-primary-500/40 hover:from-primary-700 hover:to-primary-600',
        'secondary': 'bg-slate-100 text-slate-700 hover:bg-slate-200',
        'outline': 'border-2 border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50',
        'ghost': 'text-slate-600 hover:bg-slate-100 hover:text-slate-900',
        'danger': 'bg-gradient-to-r from-red-600 to-red-500 text-white shadow-lg shadow-red-500/25 hover:shadow-red-500/40',
        'success': 'bg-gradient-to-r from-emerald-600 to-emerald-500 text-white shadow-lg shadow-emerald-500/25 hover:shadow-emerald-500/40',
        'warning': 'bg-gradient-to-r from-amber-500 to-amber-400 text-white shadow-lg shadow-amber-500/25 hover:shadow-amber-500/40',
        'link': 'text-primary-600 hover:text-primary-700 underline-offset-4 hover:underline'
    } %}
    
    {# Size styles #}
    {% set sizes = {
        'xs': 'px-2.5 py-1.5 text-xs rounded-lg',
        'sm': 'px-3.5 py-2 text-sm rounded-lg',
        'md': 'px-5 py-2.5 text-sm rounded-xl',
        'lg': 'px-6 py-3 text-base rounded-xl',
        'xl': 'px-8 py-4 text-lg rounded-2xl'
    } %}
    
    {% set base_classes = "inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" %}
    {% set width_class = "w-full" if full_width else "" %}
    
    {% if href %}
    <a href="{{ href }}" 
       class="{{ base_classes }} {{ variants[variant] }} {{ sizes[size] }} {{ width_class }} {{ class }}"
       {% if disabled %}aria-disabled="true" tabindex="-1"{% endif %}>
        {% if icon and icon_position == 'left' %}
        <span class="mr-2 -ml-0.5">{{ icon|safe }}</span>
        {% endif %}
        {{ text }}
        {% if icon and icon_position == 'right' %}
        <span class="ml-2 -mr-0.5">{{ icon|safe }}</span>
        {% endif %}
    </a>
    {% else %}
    <button type="{{ type }}" 
            class="{{ base_classes }} {{ variants[variant] }} {{ sizes[size] }} {{ width_class }} {{ class }}"
            {% if disabled %}disabled{% endif %}>
        {% if icon and icon_position == 'left' %}
        <span class="mr-2 -ml-0.5">{{ icon|safe }}</span>
        {% endif %}
        {{ text }}
        {% if icon and icon_position == 'right' %}
        <span class="ml-2 -mr-0.5">{{ icon|safe }}</span>
        {% endif %}
    </button>
    {% endif %}
{% endmacro %}


{# ============================================
   CARD COMPONENT
   ============================================ #}
{% macro card(
    title=none,
    subtitle=none,
    footer=none,
    padding="md",
    hover=false,
    class=""
) %}
    {% set paddings = {
        'none': '',
        'sm': 'p-4',
        'md': 'p-6',
        'lg': 'p-8'
    } %}
    
    {% set hover_class = "card-hover" if hover else "" %}
    
    <div class="bg-white rounded-2xl shadow-soft border border-slate-200/60 overflow-hidden {{ hover_class }} {{ class }}">
        {% if title or subtitle %}
        <div class="px-6 py-4 bg-slate-50/80 border-b border-slate-200">
            {% if title %}
            <h3 class="text-lg font-semibold text-slate-900">{{ title }}</h3>
            {% endif %}
            {% if subtitle %}
            <p class="text-sm text-slate-500 mt-0.5">{{ subtitle }}</p>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="{{ paddings[padding] }}">
            {{ caller() }}
        </div>
        
        {% if footer %}
        <div class="px-6 py-4 bg-slate-50/50 border-t border-slate-200">
            {{ footer|safe }}
        </div>
        {% endif %}
    </div>
{% endmacro %}


{# Simple card without caller #}
{% macro card_simple(
    title=none,
    subtitle=none,
    content="",
    footer=none,
    padding="md",
    hover=false,
    class=""
) %}
    {% set paddings = {
        'none': '',
        'sm': 'p-4',
        'md': 'p-6',
        'lg': 'p-8'
    } %}
    
    {% set hover_class = "card-hover" if hover else "" %}
    
    <div class="bg-white rounded-2xl shadow-soft border border-slate-200/60 overflow-hidden {{ hover_class }} {{ class }}">
        {% if title or subtitle %}
        <div class="px-6 py-4 bg-slate-50/80 border-b border-slate-200">
            {% if title %}
            <h3 class="text-lg font-semibold text-slate-900">{{ title }}</h3>
            {% endif %}
            {% if subtitle %}
            <p class="text-sm text-slate-500 mt-0.5">{{ subtitle }}</p>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="{{ paddings[padding] }}">
            {{ content|safe }}
        </div>
        
        {% if footer %}
        <div class="px-6 py-4 bg-slate-50/50 border-t border-slate-200">
            {{ footer|safe }}
        </div>
        {% endif %}
    </div>
{% endmacro %}


{# ============================================
   FORM INPUT COMPONENT
   ============================================ #}
{% macro input_field(
    field=none,
    label=none,
    placeholder="",
    help_text=none,
    required=false,
    type="text",
    name="",
    value="",
    disabled=false,
    readonly=false,
    class=""
) %}
    <div class="space-y-2">
        {% if label %}
        <label {% if field %}for="{{ field.id }}"{% elif name %}for="{{ name }}"{% endif %} 
               class="block text-sm font-medium text-slate-700">
            {{ label }}
            {% if required %}<span class="text-red-500 ml-0.5">*</span>{% endif %}
        </label>
        {% endif %}
        
        {% if field %}
            {# WTForms field #}
            {{ field(
                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all " + class,
                placeholder=placeholder,
                disabled=disabled,
                readonly=readonly
            ) }}
            {% if field.errors %}
            <p class="text-sm text-red-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ field.errors[0] }}
            </p>
            {% endif %}
        {% else %}
            {# Plain HTML input #}
            <input type="{{ type }}"
                   {% if name %}name="{{ name }}" id="{{ name }}"{% endif %}
                   value="{{ value }}"
                   placeholder="{{ placeholder }}"
                   class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all {{ class }}"
                   {% if disabled %}disabled{% endif %}
                   {% if readonly %}readonly{% endif %}
                   {% if required %}required{% endif %}>
        {% endif %}
        
        {% if help_text %}
        <p class="text-sm text-slate-500">{{ help_text }}</p>
        {% endif %}
    </div>
{% endmacro %}


{# Textarea component #}
{% macro textarea_field(
    field=none,
    label=none,
    placeholder="",
    help_text=none,
    required=false,
    name="",
    value="",
    rows=4,
    disabled=false,
    readonly=false,
    class=""
) %}
    <div class="space-y-2">
        {% if label %}
        <label {% if field %}for="{{ field.id }}"{% elif name %}for="{{ name }}"{% endif %} 
               class="block text-sm font-medium text-slate-700">
            {{ label }}
            {% if required %}<span class="text-red-500 ml-0.5">*</span>{% endif %}
        </label>
        {% endif %}
        
        {% if field %}
            {{ field(
                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all resize-none " + class,
                placeholder=placeholder,
                rows=rows,
                disabled=disabled,
                readonly=readonly
            ) }}
            {% if field.errors %}
            <p class="text-sm text-red-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ field.errors[0] }}
            </p>
            {% endif %}
        {% else %}
            <textarea {% if name %}name="{{ name }}" id="{{ name }}"{% endif %}
                      placeholder="{{ placeholder }}"
                      rows="{{ rows }}"
                      class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all resize-none {{ class }}"
                      {% if disabled %}disabled{% endif %}
                      {% if readonly %}readonly{% endif %}
                      {% if required %}required{% endif %}>{{ value }}</textarea>
        {% endif %}
        
        {% if help_text %}
        <p class="text-sm text-slate-500">{{ help_text }}</p>
        {% endif %}
    </div>
{% endmacro %}


{# Select component #}
{% macro select_field(
    field=none,
    label=none,
    options=[],
    help_text=none,
    required=false,
    name="",
    value="",
    disabled=false,
    class=""
) %}
    <div class="space-y-2">
        {% if label %}
        <label {% if field %}for="{{ field.id }}"{% elif name %}for="{{ name }}"{% endif %} 
               class="block text-sm font-medium text-slate-700">
            {{ label }}
            {% if required %}<span class="text-red-500 ml-0.5">*</span>{% endif %}
        </label>
        {% endif %}
        
        {% if field %}
            {{ field(
                class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all " + class,
                disabled=disabled
            ) }}
            {% if field.errors %}
            <p class="text-sm text-red-600 flex items-center">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                {{ field.errors[0] }}
            </p>
            {% endif %}
        {% else %}
            <select {% if name %}name="{{ name }}" id="{{ name }}"{% endif %}
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 focus:bg-white transition-all {{ class }}"
                    {% if disabled %}disabled{% endif %}
                    {% if required %}required{% endif %}>
                {% for option in options %}
                <option value="{{ option.value }}" {% if option.value == value %}selected{% endif %}>
                    {{ option.label }}
                </option>
                {% endfor %}
            </select>
        {% endif %}
        
        {% if help_text %}
        <p class="text-sm text-slate-500">{{ help_text }}</p>
        {% endif %}
    </div>
{% endmacro %}


{# ============================================
   ALERT COMPONENT
   ============================================ #}
{% macro alert(
    message,
    type="info",
    title=none,
    dismissible=false,
    icon=true,
    class=""
) %}
    {% set types = {
        'info': {
            'bg': 'bg-blue-50',
            'border': 'border-blue-200',
            'text': 'text-blue-800',
            'icon_color': 'text-blue-500',
            'icon': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
        },
        'success': {
            'bg': 'bg-emerald-50',
            'border': 'border-emerald-200',
            'text': 'text-emerald-800',
            'icon_color': 'text-emerald-500',
            'icon': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>'
        },
        'warning': {
            'bg': 'bg-amber-50',
            'border': 'border-amber-200',
            'text': 'text-amber-800',
            'icon_color': 'text-amber-500',
            'icon': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>'
        },
        'error': {
            'bg': 'bg-red-50',
            'border': 'border-red-200',
            'text': 'text-red-800',
            'icon_color': 'text-red-500',
            'icon': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>'
        }
    } %}
    
    {% set style = types[type] %}
    
    <div class="rounded-xl {{ style.bg }} border {{ style.border }} p-4 {{ class }}"
         {% if dismissible %}x-data="{ show: true }" x-show="show" x-transition{% endif %}>
        <div class="flex">
            {% if icon %}
            <div class="flex-shrink-0">
                <svg class="w-5 h-5 {{ style.icon_color }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    {{ style.icon|safe }}
                </svg>
            </div>
            {% endif %}
            <div class="{% if icon %}ml-3{% endif %} flex-1">
                {% if title %}
                <h4 class="text-sm font-semibold {{ style.text }}">{{ title }}</h4>
                {% endif %}
                <p class="text-sm {{ style.text }} {% if title %}mt-1{% endif %}">{{ message }}</p>
            </div>
            {% if dismissible %}
            <div class="ml-auto pl-3">
                <button @click="show = false" 
                        class="-mx-1.5 -my-1.5 rounded-lg p-1.5 inline-flex {{ style.text }} hover:{{ style.bg }} focus:ring-2 focus:ring-offset-2 focus:ring-offset-{{ type }}-50">
                    <span class="sr-only">Dismiss</span>
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}


{# ============================================
   MODAL COMPONENT
   ============================================ #}
{% macro modal(
    id,
    title=none,
    size="md",
    show_close=true
) %}
    {% set sizes = {
        'sm': 'max-w-sm',
        'md': 'max-w-md',
        'lg': 'max-w-lg',
        'xl': 'max-w-xl',
        '2xl': 'max-w-2xl',
        'full': 'max-w-4xl'
    } %}
    
    <div id="{{ id }}"
         x-data="{ open: false }"
         x-show="open"
         x-cloak
         @open-{{ id }}.window="open = true"
         @close-{{ id }}.window="open = false"
         @keydown.escape.window="open = false"
         class="fixed inset-0 z-50 overflow-y-auto">
        <div class="min-h-screen px-4 text-center flex items-center justify-center">
            {# Backdrop #}
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 @click="open = false"
                 class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
            
            {# Modal Panel #}
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="relative bg-white rounded-2xl {{ sizes[size] }} w-full text-left shadow-xl overflow-hidden">
                
                {% if title or show_close %}
                <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200">
                    {% if title %}
                    <h3 class="text-lg font-semibold text-slate-900">{{ title }}</h3>
                    {% endif %}
                    {% if show_close %}
                    <button @click="open = false" 
                            class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="p-6">
                    {{ caller() }}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}


{# Simple modal without caller #}
{% macro modal_simple(
    id,
    title=none,
    content="",
    footer=none,
    size="md",
    show_close=true
) %}
    {% set sizes = {
        'sm': 'max-w-sm',
        'md': 'max-w-md',
        'lg': 'max-w-lg',
        'xl': 'max-w-xl',
        '2xl': 'max-w-2xl',
        'full': 'max-w-4xl'
    } %}
    
    <div id="{{ id }}"
         x-data="{ open: false }"
         x-show="open"
         x-cloak
         @open-{{ id }}.window="open = true"
         @close-{{ id }}.window="open = false"
         @keydown.escape.window="open = false"
         class="fixed inset-0 z-50 overflow-y-auto">
        <div class="min-h-screen px-4 text-center flex items-center justify-center">
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 @click="open = false"
                 class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
            
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="relative bg-white rounded-2xl {{ sizes[size] }} w-full text-left shadow-xl overflow-hidden">
                
                {% if title or show_close %}
                <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200">
                    {% if title %}
                    <h3 class="text-lg font-semibold text-slate-900">{{ title }}</h3>
                    {% endif %}
                    {% if show_close %}
                    <button @click="open = false" 
                            class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="p-6">{{ content|safe }}</div>
                
                {% if footer %}
                <div class="px-6 py-4 bg-slate-50 border-t border-slate-200">
                    {{ footer|safe }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}


{# Confirmation modal #}
{% macro confirm_modal(
    id,
    title="Confirm Action",
    message="Are you sure you want to proceed?",
    confirm_text="Confirm",
    cancel_text="Cancel",
    variant="danger",
    action_url=none,
    method="POST"
) %}
    {% set icons = {
        'danger': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
        'warning': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
        'info': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
    } %}
    
    {% set colors = {
        'danger': {'bg': 'bg-red-100', 'icon': 'text-red-600', 'btn': 'bg-red-600 hover:bg-red-700'},
        'warning': {'bg': 'bg-amber-100', 'icon': 'text-amber-600', 'btn': 'bg-amber-600 hover:bg-amber-700'},
        'info': {'bg': 'bg-blue-100', 'icon': 'text-blue-600', 'btn': 'bg-blue-600 hover:bg-blue-700'}
    } %}
    
    {% set style = colors[variant] %}
    
    <div id="{{ id }}"
         x-data="{ open: false }"
         x-show="open"
         x-cloak
         @open-{{ id }}.window="open = true"
         @close-{{ id }}.window="open = false"
         class="fixed inset-0 z-50 overflow-y-auto">
        <div class="min-h-screen px-4 text-center flex items-center justify-center">
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 @click="open = false"
                 class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
            
            <div x-show="open"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="relative bg-white rounded-2xl max-w-md w-full p-6 text-left shadow-xl">
                
                <div class="w-12 h-12 mx-auto {{ style.bg }} rounded-xl flex items-center justify-center mb-4">
                    <svg class="w-6 h-6 {{ style.icon }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        {{ icons[variant]|safe }}
                    </svg>
                </div>
                
                <h3 class="text-lg font-semibold text-slate-900 text-center mb-2">{{ title }}</h3>
                <p class="text-slate-500 text-center mb-6">{{ message }}</p>
                
                <div class="flex space-x-3">
                    <button @click="open = false"
                            class="flex-1 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl font-medium hover:bg-slate-200 transition-colors">
                        {{ cancel_text }}
                    </button>
                    {% if action_url %}
                    <form action="{{ action_url }}" method="{{ method }}" class="flex-1">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit"
                                class="w-full px-4 py-2.5 {{ style.btn }} text-white rounded-xl font-medium transition-colors">
                            {{ confirm_text }}
                        </button>
                    </form>
                    {% else %}
                    <button @click="$dispatch('confirm-{{ id }}'); open = false"
                            class="flex-1 px-4 py-2.5 {{ style.btn }} text-white rounded-xl font-medium transition-colors">
                        {{ confirm_text }}
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endmacro %}


{# ============================================
   TABLE COMPONENT
   ============================================ #}
{% macro table(
    headers=[],
    class=""
) %}
    <div class="bg-white rounded-2xl shadow-soft border border-slate-200/60 overflow-hidden {{ class }}">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                {% if headers %}
                <thead class="bg-slate-50/80">
                    <tr>
                        {% for header in headers %}
                        <th scope="col" 
                            class="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">
                            {{ header }}
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                {% endif %}
                <tbody class="bg-white divide-y divide-slate-100">
                    {{ caller() }}
                </tbody>
            </table>
        </div>
    </div>
{% endmacro %}


{# Table row #}
{% macro table_row(hover=true) %}
    <tr class="{% if hover %}hover:bg-slate-50 transition-colors{% endif %}">
        {{ caller() }}
    </tr>
{% endmacro %}


{# Table cell #}
{% macro table_cell(class="") %}
    <td class="px-6 py-4 whitespace-nowrap {{ class }}">
        {{ caller() }}
    </td>
{% endmacro %}


{# ============================================
   BADGE COMPONENT
   ============================================ #}
{% macro badge(
    text,
    variant="default",
    size="md",
    dot=false,
    class=""
) %}
    {% set variants = {
        'default': 'bg-slate-100 text-slate-700',
        'primary': 'bg-primary-100 text-primary-700',
        'success': 'bg-emerald-100 text-emerald-700',
        'warning': 'bg-amber-100 text-amber-700',
        'danger': 'bg-red-100 text-red-700',
        'info': 'bg-blue-100 text-blue-700'
    } %}
    
    {% set sizes = {
        'sm': 'px-2 py-0.5 text-xs',
        'md': 'px-2.5 py-1 text-xs',
        'lg': 'px-3 py-1.5 text-sm'
    } %}
    
    {% set dot_colors = {
        'default': 'bg-slate-500',
        'primary': 'bg-primary-500',
        'success': 'bg-emerald-500',
        'warning': 'bg-amber-500',
        'danger': 'bg-red-500',
        'info': 'bg-blue-500'
    } %}
    
    <span class="inline-flex items-center {{ variants[variant] }} {{ sizes[size] }} rounded-full font-medium {{ class }}">
        {% if dot %}
        <span class="w-1.5 h-1.5 {{ dot_colors[variant] }} rounded-full mr-1.5"></span>
        {% endif %}
        {{ text }}
    </span>
{% endmacro %}


{# ============================================
   AVATAR COMPONENT
   ============================================ #}
{% macro avatar(
    name="",
    src=none,
    size="md",
    variant="primary",
    class=""
) %}
    {% set sizes = {
        'xs': 'w-6 h-6 text-xs',
        'sm': 'w-8 h-8 text-sm',
        'md': 'w-10 h-10 text-base',
        'lg': 'w-12 h-12 text-lg',
        'xl': 'w-16 h-16 text-xl',
        '2xl': 'w-20 h-20 text-2xl'
    } %}
    
    {% set variants = {
        'primary': 'bg-gradient-to-br from-primary-500 to-primary-600',
        'blue': 'bg-gradient-to-br from-blue-500 to-blue-600',
        'emerald': 'bg-gradient-to-br from-emerald-500 to-emerald-600',
        'violet': 'bg-gradient-to-br from-violet-500 to-purple-600',
        'amber': 'bg-gradient-to-br from-amber-500 to-orange-600',
        'slate': 'bg-gradient-to-br from-slate-500 to-slate-600'
    } %}
    
    {% if src %}
    <img src="{{ src }}" 
         alt="{{ name }}" 
         class="{{ sizes[size] }} rounded-xl object-cover {{ class }}">
    {% else %}
    <div class="{{ sizes[size] }} {{ variants[variant] }} rounded-xl flex items-center justify-center {{ class }}">
        <span class="text-white font-bold">{{ name[0]|upper if name else '?' }}</span>
    </div>
    {% endif %}
{% endmacro %}


{# ============================================
   EMPTY STATE COMPONENT
   ============================================ #}
{% macro empty_state(
    title="No data found",
    description="",
    icon=none,
    action_text=none,
    action_url=none,
    class=""
) %}
    <div class="text-center py-12 {{ class }}">
        {% if icon %}
        <div class="mx-auto w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mb-4">
            {{ icon|safe }}
        </div>
        {% else %}
        <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
        </svg>
        {% endif %}
        <h3 class="mt-4 text-lg font-semibold text-slate-900">{{ title }}</h3>
        {% if description %}
        <p class="mt-2 text-slate-500">{{ description }}</p>
        {% endif %}
        {% if action_text and action_url %}
        <div class="mt-6">
            {{ button(action_text, href=action_url, variant="primary") }}
        </div>
        {% endif %}
    </div>
{% endmacro %}


{# ============================================
   STAT CARD COMPONENT
   ============================================ #}
{% macro stat_card(
    title,
    value,
    change=none,
    change_type="neutral",
    icon=none,
    icon_color="primary",
    class=""
) %}
    {% set icon_colors = {
        'primary': 'from-primary-500 to-primary-600 shadow-primary-500/30',
        'blue': 'from-blue-500 to-blue-600 shadow-blue-500/30',
        'emerald': 'from-emerald-500 to-emerald-600 shadow-emerald-500/30',
        'violet': 'from-violet-500 to-purple-600 shadow-violet-500/30',
        'amber': 'from-amber-500 to-orange-600 shadow-amber-500/30',
        'red': 'from-red-500 to-red-600 shadow-red-500/30'
    } %}
    
    {% set change_colors = {
        'positive': 'text-emerald-600 bg-emerald-50',
        'negative': 'text-red-600 bg-red-50',
        'neutral': 'text-slate-600 bg-slate-50'
    } %}
    
    <div class="bg-white rounded-2xl shadow-soft border border-slate-200/60 p-6 {{ class }}">
        <div class="flex items-center justify-between">
            {% if icon %}
            <div class="p-3 bg-gradient-to-br {{ icon_colors[icon_color] }} rounded-xl shadow-lg">
                {{ icon|safe }}
            </div>
            {% endif %}
            {% if change is not none %}
            <span class="flex items-center text-sm font-medium {{ change_colors[change_type] }} px-2.5 py-1 rounded-lg">
                {% if change_type == 'positive' %}
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                </svg>
                {% elif change_type == 'negative' %}
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
                {% endif %}
                {{ change }}
            </span>
            {% endif %}
        </div>
        <div class="mt-4">
            <h3 class="text-3xl font-bold text-slate-900">{{ value }}</h3>
            <p class="text-sm text-slate-500 mt-1">{{ title }}</p>
        </div>
    </div>
{% endmacro %}


{# ============================================
   PAGINATION COMPONENT
   ============================================ #}
{% macro pagination(
    paginator,
    endpoint,
    class=""
) %}
    {% if paginator.pages > 1 %}
    <div class="flex items-center justify-between px-4 py-3 bg-white border-t border-slate-200 {{ class }}">
        <div class="text-sm text-slate-700">
            Showing <span class="font-medium">{{ paginator.per_page * (paginator.page - 1) + 1 }}</span> to 
            <span class="font-medium">{{ paginator.per_page * (paginator.page - 1) + paginator.items|length }}</span> of 
            <span class="font-medium">{{ paginator.total }}</span> results
        </div>
        <div class="flex space-x-2">
            {% if paginator.has_prev %}
            <a href="{{ url_for(endpoint, page=paginator.prev_num, **kwargs) }}" 
               class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-200 transition-colors">
                Previous
            </a>
            {% endif %}
            {% if paginator.has_next %}
            <a href="{{ url_for(endpoint, page=paginator.next_num, **kwargs) }}" 
               class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-200 transition-colors">
                Next
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
{% endmacro %}


{# ============================================
   DROPDOWN COMPONENT
   ============================================ #}
{% macro dropdown(
    trigger_text,
    items=[],
    align="right",
    class=""
) %}
    {% set alignments = {
        'left': 'left-0',
        'right': 'right-0'
    } %}
    
    <div x-data="{ open: false }" class="relative inline-block text-left {{ class }}">
        <button @click="open = !open" 
                @click.away="open = false"
                class="inline-flex items-center px-4 py-2 bg-white border border-slate-200 rounded-xl text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
            {{ trigger_text }}
            <svg class="ml-2 -mr-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        
        <div x-show="open"
             x-transition:enter="transition ease-out duration-100"
             x-transition:enter-start="transform opacity-0 scale-95"
             x-transition:enter-end="transform opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-75"
             x-transition:leave-start="transform opacity-100 scale-100"
             x-transition:leave-end="transform opacity-0 scale-95"
             class="absolute {{ alignments[align] }} mt-2 w-56 rounded-xl bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
            <div class="py-1">
                {% for item in items %}
                {% if item.divider %}
                <hr class="my-1 border-slate-200">
                {% else %}
                <a href="{{ item.url }}" 
                   class="flex items-center px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 {% if item.danger %}text-red-600 hover:bg-red-50{% endif %}">
                    {% if item.icon %}
                    <span class="mr-3">{{ item.icon|safe }}</span>
                    {% endif %}
                    {{ item.label }}
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
{% endmacro %}
